<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart.js Animation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            background-color: #f5f5f5;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            margin: 0 10px;
            font-size: 16px;
            cursor: pointer;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #2980b9;
        }
        .chart-container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin: 20px 0;
        }
        #info {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
</head>
<body>
    <h1>Chart.js Animation Enhancement Test</h1>
    
    <div id="info">
        <p><strong>Testing:</strong> Smooth chart entry animations and data update transitions</p>
        <p>Click buttons below to test different data sizes and animation behaviors</p>
    </div>
    
    <div class="controls">
        <button onclick="loadSmallDataset()">Small Dataset (5 points)</button>
        <button onclick="loadMediumDataset()">Medium Dataset (20 points)</button>
        <button onclick="loadLargeDataset()">Large Dataset (100 points)</button>
        <button onclick="updateRandomData()">Random Update</button>
        <button onclick="resetChart()">Reset Chart</button>
    </div>
    
    <div class="chart-container">
        <canvas id="testChart"></canvas>
    </div>
    
    <div id="info">
        <p><strong>Animation Features:</strong></p>
        <ul style="text-align: left; display: inline-block;">
            <li>✅ 750ms smooth entry animation with easeInOutQuart easing</li>
            <li>✅ Data points animate from zero on initial load</li>
            <li>✅ Smooth transitions when data updates (no destroy/recreate)</li>
            <li>✅ Respects prefers-reduced-motion accessibility setting</li>
            <li>✅ Hover and resize animations included</li>
        </ul>
    </div>

    <script>
        let chartInstance = null;
        
        // Generate sample data
        function generateData(count, startValue = 0) {
            const labels = [];
            const data = [];
            let currentValue = startValue;
            
            for (let i = 0; i < count; i++) {
                labels.push(`23_${String(9 + Math.floor(i / 30)).padStart(2, '0')}_${String((i % 30) + 1).padStart(2, '0')}`);
                // Random walk for realistic poker winnings
                currentValue += (Math.random() - 0.45) * 100;
                data.push(currentValue);
            }
            
            return { labels, data };
        }
        
        function createOrUpdateChart(labels, data) {
            const isDark = false; // Light mode for testing
            const gridColor = isDark ? '#444' : '#ddd';
            const textColor = isDark ? '#e0e0e0' : '#333';
            
            // Detect user's motion preference for accessibility
            const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            
            // Configure animation settings based on accessibility preferences
            const animationDuration = prefersReducedMotion ? 0 : 750;
            const animationEasing = 'easeInOutQuart';
            
            const chartData = {
                labels: labels,
                datasets: [{
                    label: 'Net Winnings ($)',
                    data: data,
                    borderColor: '#888888',
                    borderWidth: 2,
                    fill: false,
                    pointRadius: 3,
                    pointBackgroundColor: '#888888',
                    pointBorderColor: '#888888',
                    pointHoverBackgroundColor: '#3498db',
                    pointHoverBorderColor: '#3498db',
                    pointHoverRadius: 5,
                    segment: {
                        borderColor: ctx => {
                            const { p0, p1 } = ctx;
                            if (!p0 || !p1) return '#888888';
                            return p1.parsed.y > p0.parsed.y ? '#00FF00' : 
                                   (p1.parsed.y < p0.parsed.y ? '#FF0000' : '#888888');
                        }
                    }
                }]
            };
            
            const config = {
                type: 'line',
                data: chartData,
                options: {
                    // Animation configuration for smooth chart entry and updates
                    animation: {
                        duration: animationDuration,
                        easing: animationEasing,
                        // Animate from center for a smooth entry effect
                        animateScale: true,
                        animateRotate: true
                    },
                    // Specific animations for different update modes
                    animations: {
                        // Smooth animations when data changes
                        x: {
                            type: 'number',
                            easing: animationEasing,
                            duration: animationDuration,
                            from: (ctx) => {
                                if (ctx.type === 'data') {
                                    // Animate from previous position
                                    if (ctx.mode === 'default' && !ctx.dropped) {
                                        ctx.dropped = true;
                                        return ctx.chart.scales.x.getPixelForValue(ctx.index);
                                    }
                                }
                            }
                        },
                        y: {
                            type: 'number',
                            easing: animationEasing,
                            duration: animationDuration,
                            from: (ctx) => {
                                if (ctx.type === 'data') {
                                    // Animate from zero for a smooth rise effect
                                    if (ctx.mode === 'default' && !ctx.dropped) {
                                        ctx.dropped = true;
                                        return ctx.chart.scales.y.getPixelForValue(0);
                                    }
                                }
                            }
                        }
                    },
                    // Smooth transitions between data updates
                    transitions: {
                        // Active transition when hovering
                        active: {
                            animation: {
                                duration: prefersReducedMotion ? 0 : 200
                            }
                        },
                        // Resize transition
                        resize: {
                            animation: {
                                duration: prefersReducedMotion ? 0 : 400
                            }
                        },
                        // Show/hide transitions
                        show: {
                            animations: {
                                x: {
                                    from: 0
                                },
                                y: {
                                    from: 0
                                }
                            }
                        },
                        hide: {
                            animations: {
                                x: {
                                    to: 0
                                },
                                y: {
                                    to: 0
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: textColor,
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        x: {
                            title: { 
                                display: true, 
                                text: 'Date',
                                color: textColor,
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                color: textColor,
                                maxRotation: 45,
                                minRotation: 0
                            },
                            grid: {
                                color: gridColor
                            }
                        },
                        y: {
                            title: { 
                                display: true, 
                                text: 'Net Winnings ($)',
                                color: textColor,
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                color: textColor,
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            },
                            grid: {
                                color: gridColor
                            }
                        }
                    },
                    // Responsive and maintain aspect ratio
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            };
            
            // Update existing chart if present, otherwise create new one
            // This allows for smooth transitions between data updates
            if (chartInstance) {
                console.log('Updating existing chart with animation...');
                chartInstance.data = chartData;
                chartInstance.options = config.options;
                // Update with animation mode 'default' for smooth transitions
                chartInstance.update('default');
            } else {
                console.log('Creating new chart...');
                const ctx = document.getElementById('testChart').getContext('2d');
                chartInstance = new Chart(ctx, config);
            }
        }
        
        function loadSmallDataset() {
            console.log('Loading small dataset (5 points)...');
            const { labels, data } = generateData(5);
            createOrUpdateChart(labels, data);
        }
        
        function loadMediumDataset() {
            console.log('Loading medium dataset (20 points)...');
            const { labels, data } = generateData(20);
            createOrUpdateChart(labels, data);
        }
        
        function loadLargeDataset() {
            console.log('Loading large dataset (100 points)...');
            const { labels, data } = generateData(100);
            createOrUpdateChart(labels, data);
        }
        
        function updateRandomData() {
            console.log('Updating with random data...');
            const currentSize = chartInstance ? chartInstance.data.labels.length : 20;
            const { labels, data } = generateData(currentSize, Math.random() * 200 - 100);
            createOrUpdateChart(labels, data);
        }
        
        function resetChart() {
            if (chartInstance) {
                console.log('Destroying chart...');
                chartInstance.destroy();
                chartInstance = null;
            }
            setTimeout(() => {
                console.log('Creating fresh chart...');
                loadMediumDataset();
            }, 100);
        }
        
        // Load medium dataset on page load
        window.addEventListener('load', () => {
            console.log('Page loaded. Initializing chart...');
            setTimeout(() => {
                loadMediumDataset();
            }, 300);
        });
    </script>
</body>
</html>
